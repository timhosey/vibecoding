<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimTV CRT Bounce</title>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        /* Page title styling */
        .page-title {
            color: #fff;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        /* CRT TV container */
        .tv-container {
            position: relative;
            background: #333;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 
                0 0 50px rgba(0, 0, 0, 0.8),
                inset 0 0 20px rgba(0, 0, 0, 0.5);
            width: 800px;
            height: 600px;
        }

        /* TV screen area */
        .tv-screen {
            position: relative;
            background: #000;
            border: 3px solid #555;
            border-radius: 10px;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }

        /* Game canvas */
        #gameCanvas {
            display: block;
            background: #000;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        /* CRT scanlines effect */
        .scanlines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 0, 0, 0.3) 2px,
                rgba(0, 0, 0, 0.3) 4px
            );
        }

        /* CRT vignette effect */
        .vignette {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: radial-gradient(
                ellipse at center,
                transparent 30%,
                rgba(0, 0, 0, 0.3) 70%,
                rgba(0, 0, 0, 0.8) 100%
            );
        }

        /* Hamburger menu button */
        .menu-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #555;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            font-size: 18px;
            padding: 10px 15px;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .menu-toggle:hover {
            background: rgba(0, 0, 0, 0.9);
            border-color: #777;
        }

        /* Flyout menu */
        .menu-flyout {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            border-right: 3px solid #555;
            box-shadow: 5px 0 20px rgba(0, 0, 0, 0.8);
            z-index: 999;
            transition: left 0.3s ease;
            overflow-y: auto;
        }

        .menu-flyout.open {
            left: 0;
        }

        .menu-header {
            padding: 20px;
            border-bottom: 2px solid #555;
            text-align: center;
        }

        .menu-title {
            color: #fff;
            font-size: 18px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .menu-close {
            background: #ff4040;
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
            padding: 8px 15px;
            transition: background 0.3s ease;
        }

        .menu-close:hover {
            background: #ff6060;
        }

        .menu-content {
            padding: 20px;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-label {
            color: #fff;
            display: block;
            font-size: 14px;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .slider-container {
            position: relative;
            margin-bottom: 15px;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #555;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00ff80;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 255, 128, 0.5);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00ff80;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(0, 255, 128, 0.5);
        }

        .slider-value {
            color: #00ff80;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            margin-top: 5px;
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .menu-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        /* TV bezel styling */
        .tv-bezel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 8px solid #222;
            border-radius: 15px;
            pointer-events: none;
        }

        .tv-bezel::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border: 2px solid #444;
            border-radius: 19px;
        }
    </style>
</head>
<body>
    <h1 class="page-title">TimTV CRT Bounce</h1>
    
    <!-- Hamburger menu button -->
    <button class="menu-toggle" id="menuToggle">☰</button>
    
    <!-- Flyout menu -->
    <div class="menu-flyout" id="menuFlyout">
        <div class="menu-header">
            <div class="menu-title">Settings</div>
            <button class="menu-close" id="menuClose">✕ Close</button>
        </div>
        <div class="menu-content">
            <div class="control-group">
                <label class="control-label">Bounce Speed</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="speedSlider" min="0.5" max="5" step="0.1" value="2.1">
                    <div class="slider-value" id="speedValue">2.1</div>
                </div>
            </div>
            
            <div class="control-group">
                <label class="control-label">Particle Count</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="particleSlider" min="5" max="50" step="1" value="20">
                    <div class="slider-value" id="particleValue">20</div>
                </div>
            </div>
            
            <div class="control-group">
                <label class="control-label">Controls</label>
                <div style="color: #ccc; font-size: 12px; line-height: 1.5;">
                    <div>SPACE: Reset Logo</div>
                    <div>ESC: Exit Game</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Menu overlay -->
    <div class="menu-overlay" id="menuOverlay"></div>
    
    <div class="tv-container">
        <div class="tv-screen">
            <canvas id="gameCanvas"></canvas>
            <div class="scanlines"></div>
            <div class="vignette"></div>
            <div class="tv-bezel"></div>
        </div>
    </div>

    <script>
        /**
         * Particle class for explosion effects
         * Creates colorful particles that fly out when logo hits corners
         */
        class Particle {
            constructor(x, y, color) {
                this.x = x;                    // X position
                this.y = y;                    // Y position
                this.vx = (Math.random() - 0.5) * 16;  // Random X velocity
                this.vy = (Math.random() - 0.5) * 16;  // Random Y velocity
                this.color = color;            // Particle color
                this.life = 1.0;              // Life remaining (0-1)
                this.decay = Math.random() * 0.02 + 0.01;  // Life decay rate
                this.size = Math.random() * 4 + 2;         // Particle size
            }

            /**
             * Update particle physics
             * Applies velocity, friction, and life decay
             */
            update() {
                this.x += this.vx;             // Move by velocity
                this.y += this.vy;
                this.vx *= 0.98;              // Apply friction
                this.vy *= 0.98;
                this.life -= this.decay;      // Reduce life
                this.size *= 0.99;            // Shrink over time
            }

            /**
             * Draw the particle on canvas
             * @param {CanvasRenderingContext2D} ctx - Canvas context
             */
            draw(ctx) {
                if (this.life > 0) {
                    ctx.save();
                    ctx.globalAlpha = this.life;  // Fade based on life
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, Math.max(1, this.size), 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }
            }
        }

        /**
         * DVD Logo class - the main bouncing object
         * Handles movement, collision detection, and color changes
         */
        class DVDLogo {
            constructor(x, y, speed = 2.1) {
                this.x = x;                    // X position
                this.y = y;                    // Y position
                this.vx = speed * (Math.random() > 0.5 ? 1 : -1);  // X velocity
                this.vy = speed * (Math.random() > 0.5 ? 1 : -1);  // Y velocity
                this.width = 120;              // Logo width
                this.height = 60;              // Logo height
                
                // Neon color palette for retro aesthetic
                this.colors = [
                    '#ff0080', // Hot Pink
                    '#00ff80', // Electric Green
                    '#0080ff', // Electric Blue
                    '#ffff00', // Neon Yellow
                    '#ff8000', // Neon Orange
                    '#8000ff', // Electric Purple
                    '#00ffff', // Cyan
                    '#ff4040'  // Neon Red
                ];
                
                this.currentColor = this.colors[Math.floor(Math.random() * this.colors.length)];
                this.cornerHit = false;        // Track if currently hitting corner
                this.cornerHitTimer = 0;       // Timer for corner hit flash effect
                this.image = null;             // TimTV.png image object
                
                this.loadImage();
            }

            /**
             * Load the TimTV.png image
             * Calculates proper aspect ratio to maintain proportions
             */
            loadImage() {
                this.image = new Image();
                this.image.onload = () => {
                    // Maintain aspect ratio of the original image
                    const aspectRatio = this.image.width / this.image.height;
                    if (aspectRatio > 1) {
                        this.height = this.width / aspectRatio;
                    } else {
                        this.width = this.height * aspectRatio;
                    }
                };
                this.image.src = '../img/TimTV.png';
            }

            /**
             * Update logo position and handle collisions
             * @param {number} screenWidth - Screen width for collision detection
             * @param {number} screenHeight - Screen height for collision detection
             * @returns {boolean} - True if corner was hit (triggers explosion)
             */
            update(screenWidth, screenHeight) {
                // Move the logo by velocity
                this.x += this.vx;
                this.y += this.vy;

                // Check for corner hits (within 5 pixels of any corner)
                const cornerTolerance = 5;
                let cornerHit = false;
                
                if ((this.x <= cornerTolerance && this.y <= cornerTolerance) ||
                    (this.x + this.width >= screenWidth - cornerTolerance && this.y <= cornerTolerance) ||
                    (this.x <= cornerTolerance && this.y + this.height >= screenHeight - cornerTolerance) ||
                    (this.x + this.width >= screenWidth - cornerTolerance && this.y + this.height >= screenHeight - cornerTolerance)) {
                    cornerHit = true;
                    if (!this.cornerHit) {
                        this.cornerHit = true;
                        this.cornerHitTimer = 30;  // Flash for 30 frames
                    }
                }

                // Handle wall collisions with precise positioning
                if (this.x <= 0) {
                    this.vx = Math.abs(this.vx);  // Ensure positive velocity
                    this.x = 0;
                    this.changeColor();
                } else if (this.x + this.width >= screenWidth) {
                    this.vx = -Math.abs(this.vx); // Ensure negative velocity
                    this.x = screenWidth - this.width;
                    this.changeColor();
                }

                if (this.y <= 0) {
                    this.vy = Math.abs(this.vy);  // Ensure positive velocity
                    this.y = 0;
                    this.changeColor();
                } else if (this.y + this.height >= screenHeight) {
                    this.vy = -Math.abs(this.vy); // Ensure negative velocity
                    this.y = screenHeight - this.height;
                    this.changeColor();
                }

                // Update corner hit flash timer
                if (this.cornerHitTimer > 0) {
                    this.cornerHitTimer--;
                    if (this.cornerHitTimer === 0) {
                        this.cornerHit = false;
                    }
                }

                return cornerHit;
            }

            /**
             * Change to a different neon color
             * Ensures the new color is different from the current one
             * Called when logo hits a wall
             */
            changeColor() {
                let newColor;
                do {
                    newColor = this.colors[Math.floor(Math.random() * this.colors.length)];
                } while (newColor === this.currentColor);
                this.currentColor = newColor;
            }

            /**
             * Draw the logo with color tinting and effects
             * @param {CanvasRenderingContext2D} ctx - Canvas context
             */
            draw(ctx) {
                if (this.image && this.image.complete) {
                    // Draw the TimTV logo with neon color effects
                    ctx.save();
                    
                    // Draw original image first
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
                    
                    // Apply neon color tinting using multiply blend mode
                    ctx.globalCompositeOperation = 'multiply';
                    ctx.fillStyle = this.currentColor;
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                    
                    // Add subtle glow effect using screen blend mode
                    ctx.globalCompositeOperation = 'screen';
                    ctx.shadowColor = this.currentColor;
                    ctx.shadowBlur = 8;
                    ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
                    
                    // Reset canvas state
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.shadowBlur = 0;
                    ctx.restore();
                    
                    // Flash effect for corner hits
                    if (this.cornerHitTimer > 0 && this.cornerHitTimer % 4 < 2) {
                        ctx.save();
                        ctx.globalAlpha = 0.6;
                        ctx.globalCompositeOperation = 'multiply';
                        ctx.fillStyle = this.currentColor;
                        ctx.fillRect(this.x, this.y, this.width, this.height);
                        ctx.restore();
                    }
                } else {
                    // Fallback display while image loads
                    ctx.fillStyle = this.currentColor;
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                    
                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(this.x, this.y, this.width, this.height);
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '24px monospace';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('TimTV', this.x + this.width / 2, this.y + this.height / 2);
                }
            }
        }

        /**
         * Main Game class - manages the entire application
         * Handles canvas setup, game loop, and user input
         */
        class Game {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.particles = [];           // Array of explosion particles
                this.dvdLogo = null;           // The bouncing logo object
                this.animationId = null;       // Animation frame ID for cleanup
                
                // Settings from sliders
                this.bounceSpeed = 2.1;        // Current bounce speed
                this.particleCount = 20;       // Number of particles in explosions
                
                this.setupCanvas();
                this.setupEventListeners();
                this.setupMenu();
                this.init();
                this.gameLoop();
            }

            /**
             * Setup canvas with proper dimensions and DPI scaling
             * Ensures crisp rendering on high-DPI displays
             */
            setupCanvas() {
                const container = document.querySelector('.tv-screen');
                const rect = container.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
                
                // High DPI support for crisp rendering
                const dpr = window.devicePixelRatio || 1;
                this.canvas.width *= dpr;
                this.canvas.height *= dpr;
                this.ctx.scale(dpr, dpr);
                this.canvas.style.width = rect.width + 'px';
                this.canvas.style.height = rect.height + 'px';
            }

            /**
             * Setup keyboard event listeners
             * Handles SPACE (reset) and ESC (exit) keys
             */
            setupEventListeners() {
                window.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.reset();
                    } else if (e.code === 'Escape') {
                        this.stop();
                    }
                });

                // Handle window resize
                window.addEventListener('resize', () => {
                    this.setupCanvas();
                });
            }

            /**
             * Setup hamburger menu functionality
             * Handles menu toggle, sliders, and overlay clicks
             */
            setupMenu() {
                const menuToggle = document.getElementById('menuToggle');
                const menuFlyout = document.getElementById('menuFlyout');
                const menuClose = document.getElementById('menuClose');
                const menuOverlay = document.getElementById('menuOverlay');
                const speedSlider = document.getElementById('speedSlider');
                const particleSlider = document.getElementById('particleSlider');
                const speedValue = document.getElementById('speedValue');
                const particleValue = document.getElementById('particleValue');

                // Toggle menu open
                menuToggle.addEventListener('click', () => {
                    menuFlyout.classList.add('open');
                    menuOverlay.classList.add('open');
                });

                // Close menu
                const closeMenu = () => {
                    menuFlyout.classList.remove('open');
                    menuOverlay.classList.remove('open');
                };

                menuClose.addEventListener('click', closeMenu);
                menuOverlay.addEventListener('click', closeMenu);

                // Speed slider
                speedSlider.addEventListener('input', (e) => {
                    this.bounceSpeed = parseFloat(e.target.value);
                    speedValue.textContent = this.bounceSpeed.toFixed(1);
                    
                    // Update logo speed if it exists
                    if (this.dvdLogo) {
                        const directionX = this.dvdLogo.vx > 0 ? 1 : -1;
                        const directionY = this.dvdLogo.vy > 0 ? 1 : -1;
                        this.dvdLogo.vx = this.bounceSpeed * directionX;
                        this.dvdLogo.vy = this.bounceSpeed * directionY;
                    }
                });

                // Particle count slider
                particleSlider.addEventListener('input', (e) => {
                    this.particleCount = parseInt(e.target.value);
                    particleValue.textContent = this.particleCount;
                });
            }

            /**
             * Initialize game objects
             * Creates the logo and clears particles
             */
            init() {
                this.dvdLogo = new DVDLogo(
                    this.canvas.width / 2 / (window.devicePixelRatio || 1) - 60,
                    this.canvas.height / 2 / (window.devicePixelRatio || 1) - 30,
                    this.bounceSpeed
                );
                this.particles = [];
            }

            /**
             * Create particle explosion at specified coordinates
             * @param {number} x - X coordinate for explosion center
             * @param {number} y - Y coordinate for explosion center
             */
            createExplosion(x, y) {
                const colors = [
                    '#ff0080', '#00ff80', '#0080ff', '#ffff00',
                    '#ff8000', '#8000ff', '#00ffff', '#ff4040'
                ];
                
                // Use current particle count setting
                for (let i = 0; i < this.particleCount; i++) {
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    this.particles.push(new Particle(x, y, color));
                }
            }

            /**
             * Update all particles and remove dead ones
             * Called every frame to maintain particle effects
             */
            updateParticles() {
                this.particles = this.particles.filter(particle => particle.life > 0);
                this.particles.forEach(particle => particle.update());
            }

            /**
             * Reset the game to initial state
             * Recreates logo and clears all particles
             */
            reset() {
                this.init();
            }

            /**
             * Stop the game and close window
             * Cleans up animation frame
             */
            stop() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
                window.close();
            }

            /**
             * Main game loop - runs at 60fps
             * Updates all objects, handles collisions, and renders everything
             */
            gameLoop() {
                // Clear canvas with black background
                this.ctx.fillStyle = '#000000';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Get screen dimensions (accounting for DPI scaling)
                const screenWidth = this.canvas.width / (window.devicePixelRatio || 1);
                const screenHeight = this.canvas.height / (window.devicePixelRatio || 1);
                
                // Update logo and check for corner hits
                const cornerHit = this.dvdLogo.update(screenWidth, screenHeight);
                
                // Create explosion if corner was hit
                if (cornerHit) {
                    const centerX = this.dvdLogo.x + this.dvdLogo.width / 2;
                    const centerY = this.dvdLogo.y + this.dvdLogo.height / 2;
                    this.createExplosion(centerX, centerY);
                }

                // Update all particles
                this.updateParticles();

                // Render everything
                this.dvdLogo.draw(this.ctx);
                this.particles.forEach(particle => particle.draw(this.ctx));

                // Continue animation loop
                this.animationId = requestAnimationFrame(() => this.gameLoop());
            }
        }

        // Initialize game when page loads
        window.addEventListener('load', () => {
            new Game();
        });
    </script>
</body>
</html>